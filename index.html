<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocketChat</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #3f3f3f;
        }
        .panel-bg {
            background-color: #2f2f2f;
        }
        .request-item:hover, .message-item:hover {
            background-color: #3b3b3b;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Style the scrollbars */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background-color: #4b5563; /* Gray-600 */
            border-radius: 4px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background-color: #1f2937; /* Gray-800 */
        }
    </style>
</head>
<body class="text-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Custom message box for alerts -->
    <div id="custom-message-box" class="hidden modal-overlay">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl border border-gray-700 w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4 text-white">Alert</h3>
            <p id="message-text" class="text-gray-300 mb-6"></p>
            <div class="flex justify-end">
                <button id="close-message-box" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-200">
                    OK
                </button>
            </div>
        </div>
    </div>
    
    <!-- Feature Request Modal -->
    <div id="feature-request-modal" class="hidden modal-overlay">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl border border-gray-700 w-full max-w-lg">
            <h3 class="text-xl font-bold mb-4 text-white">Submit a Feature Request</h3>
            <textarea id="feature-request-input" rows="4" placeholder="Describe the feature you would like to see..." class="w-full p-3 rounded-lg border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-white mb-4"></textarea>
            <div class="flex justify-end space-x-2">
                <button id="cancel-request-button" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition duration-200">
                    Cancel
                </button>
                <button id="submit-request-button" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-200">
                    Submit
                </button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="name-modal" class="modal-overlay">
        <div class="panel-bg rounded-xl shadow-2xl p-6 w-full max-w-sm relative">
            <h1 class="text-3xl font-extrabold text-center mb-4 text-white">WebSocketChat</h1>
            
            <p class="text-gray-300 text-center mb-4">Please enter your username to join.</p>
            <input type="text" id="username-input" placeholder="Choose a username..." class="w-full p-3 rounded-lg border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-white mb-2" autocomplete="off">
            <button id="join-chat-button" class="w-full p-3 text-white font-bold rounded-lg bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-200">
                Join Chat
            </button>
            
            <div class="flex items-center justify-between my-4">
                <hr class="flex-grow border-gray-600">
                <span class="px-3 text-gray-400 font-bold">OR</span>
                <hr class="flex-grow border-gray-600">
            </div>

            <p class="text-gray-300 text-center mb-2">Admin Login</p>
            <input type="password" id="admin-password-input" placeholder="Admin Password" class="w-full p-3 rounded-lg border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-white mb-2" autocomplete="off">
            <button id="admin-login-button" class="w-full p-3 text-white font-bold rounded-lg bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition duration-200">
                Admin Login
            </button>
        </div>
    </div>

    <!-- User Chat Panel -->
    <div id="user-chat-panel" class="panel-bg hidden w-full h-[90vh] max-w-4xl mx-auto p-6 rounded-xl shadow-2xl grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- Left Sidebar: Connected Users & Admin Login -->
        <div class="col-span-1 flex flex-col space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold">Connected Users</h2>
                <button id="admin-panel-toggle-btn" class="hidden px-3 py-1 text-white text-sm font-bold rounded-lg bg-red-600 hover:bg-red-700 transition duration-200">
                    Admin Panel
                </button>
            </div>
            
            <div id="users-list" class="panel-bg flex-grow overflow-y-auto p-2 rounded-xl border border-gray-600">
                <!-- Connected users will be injected here -->
            </div>
            
            <div class="flex-grow"></div> <!-- Spacer to push elements to the bottom -->

            <!-- User Actions Section -->
            <div class="flex flex-col space-y-2">
                <div class="flex items-center justify-between">
                    <span id="current-user" class="text-sm font-medium text-gray-400"></span>
                    <button id="feature-request-button" class="px-3 py-1 text-white text-sm font-bold rounded-lg bg-blue-600 hover:bg-blue-700 transition duration-200">
                        Feature Request
                    </button>
                </div>
                <div class="flex justify-end">
                    <button id="leave-button" class="px-3 py-1 text-white text-sm font-bold rounded-lg bg-red-600 hover:bg-red-700 transition duration-200">
                        Leave Chat
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Column: Chat Display and Input -->
        <div class="col-span-1 md:col-span-2 flex flex-col">
            <h1 class="text-2xl font-extrabold mb-4">WebSocketChat</h1>
            <!-- Chat messages container -->
            <div id="chat-container" class="panel-bg flex-grow overflow-y-auto p-4 rounded-xl border border-gray-600 mb-4">
                <!-- Messages will be injected here -->
            </div>
            <!-- Message input form -->
            <form id="message-form" class="flex items-center space-x-2">
                <input type="text" id="message-input" placeholder="Type a message..." class="flex-grow p-3 rounded-lg border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-white" autocomplete="off">
                <button type="button" id="send-button" class="p-3 text-white font-bold rounded-lg bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-200">
                    Send
                </button>
            </form>
        </div>
    </div>

    <!-- Moderator Panel -->
    <div id="moderator-panel" class="panel-bg hidden w-full h-[90vh] max-w-4xl mx-auto p-6 rounded-xl shadow-2xl grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- Left Column: User and Ban Controls -->
        <div id="mod-control-panel" class="col-span-1 flex flex-col space-y-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-extrabold">Moderator Panel</h1>
                <div class="flex items-center space-x-2">
                    <button id="admin-chat-toggle-btn" class="px-3 py-1 text-white text-sm font-bold rounded-lg bg-blue-600 hover:bg-blue-700 transition duration-200">
                        Admin Chat
                    </button>
                    <span id="mod-logged-in-as" class="text-sm font-medium text-gray-400"></span>
                    <button id="mod-leave-button" class="px-3 py-1 text-white text-sm font-bold rounded-lg bg-red-600 hover:bg-red-700 transition duration-200">
                        Logout
                    </button>
                </div>
            </div>
            
            <div class="flex flex-col flex-grow">
                <h3 class="text-lg font-semibold text-gray-300">Connected Users</h3>
                <div id="mod-connected-users-list" class="panel-bg overflow-y-auto p-2 rounded-xl border border-gray-600 mb-4 h-1/2">
                    <!-- Connected users with Ban button -->
                </div>
                <h3 class="text-lg font-semibold text-gray-300">Banned Users</h3>
                <div id="mod-banned-users-list" class="panel-bg overflow-y-auto p-2 rounded-xl border border-gray-600 h-1/2">
                    <!-- Banned users with Unban button -->
                </div>
            </div>
        </div>

        <!-- Right Column: Feature Requests Inbox -->
        <div class="col-span-1 flex flex-col" id="mod-feature-requests-panel">
            <h2 class="text-2xl font-extrabold text-white mb-4">Feature Requests Inbox</h2>
            <div id="mod-feature-requests-list" class="panel-bg flex-grow overflow-y-auto p-4 rounded-xl border border-gray-600">
                <!-- Feature requests will be injected here -->
            </div>
        </div>

        <!-- Admin Chat Panel -->
        <div id="admin-chat-panel" class="col-span-2 flex flex-col hidden">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-2xl font-extrabold text-white">Admin Chat</h1>
                <button id="admin-back-to-mod-panel-btn" class="px-4 py-2 text-white font-bold rounded-lg bg-gray-600 hover:bg-gray-700 transition duration-200">
                    Back to Panel
                </button>
            </div>
            <div id="admin-chat-container" class="panel-bg flex-grow overflow-y-auto p-4 rounded-xl border border-gray-600 mb-4">
                <!-- Admin chat messages will be injected here -->
            </div>
            <form id="admin-chat-form" class="flex items-center space-x-2">
                <input type="text" id="admin-chat-input" placeholder="Message admins..." class="flex-grow p-3 rounded-lg border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-white" autocomplete="off">
                <button type="button" id="admin-chat-send-btn" class="p-3 text-white font-bold rounded-lg bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200">
                    Send
                </button>
            </form>
        </div>
    </div>
    
    <script>
        // Global variables
        let ws;
        let currentUser = null;
        let connectedUsers = [];
        let bannedUsers = [];
        let messages = [];
        let adminMessages = [];
        let featureRequests = [];
        let currentPanel = 'user'; // 'user', 'moderator', 'admin-chat'

        // Element references
        const nameModal = document.getElementById('name-modal');
        const usernameInput = document.getElementById('username-input');
        const adminPasswordInput = document.getElementById('admin-password-input');
        const joinChatButton = document.getElementById('join-chat-button');
        const adminLoginButton = document.getElementById('admin-login-button');
        const userChatPanel = document.getElementById('user-chat-panel');
        const moderatorPanel = document.getElementById('moderator-panel');
        const adminChatPanel = document.getElementById('admin-chat-panel');
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const usersList = document.getElementById('users-list');
        const leaveButton = document.getElementById('leave-button');
        const adminPanelToggleBtn = document.getElementById('admin-panel-toggle-btn');
        const modLoggedInAs = document.getElementById('mod-logged-in-as');
        const modLeaveButton = document.getElementById('mod-leave-button');
        const modConnectedUsersList = document.getElementById('mod-connected-users-list');
        const modBannedUsersList = document.getElementById('mod-banned-users-list');
        const adminChatToggleBtn = document.getElementById('admin-chat-toggle-btn');
        const adminBackToModPanelBtn = document.getElementById('admin-back-to-mod-panel-btn');
        const adminChatContainer = document.getElementById('admin-chat-container');
        const adminChatInput = document.getElementById('admin-chat-input');
        const adminChatSendBtn = document.getElementById('admin-chat-send-btn');
        const featureRequestButton = document.getElementById('feature-request-button');
        const featureRequestModal = document.getElementById('feature-request-modal');
        const cancelRequestButton = document.getElementById('cancel-request-button');
        const submitRequestButton = document.getElementById('submit-request-button');
        const featureRequestInput = document.getElementById('feature-request-input');
        const modFeatureRequestsList = document.getElementById('mod-feature-requests-list');
        const customMessageBox = document.getElementById('custom-message-box');
        const messageText = document.getElementById('message-text');
        const closeMessageBox = document.getElementById('close-message-box');
        const currentUserSpan = document.getElementById('current-user');
        
        /**
         * Custom message box to replace alert().
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            messageText.textContent = message;
            customMessageBox.classList.remove('hidden');
        }

        /**
         * Renders the chat messages to the UI.
         */
        function renderMessages(messagesToRender, container) {
            container.innerHTML = '';
            messagesToRender.forEach(message => {
                const messageItem = document.createElement('div');
                messageItem.className = 'p-3 rounded-lg message-item';
                let senderClass = 'text-gray-300';
                if (message.userName === 'Admin') {
                    senderClass = 'text-red-400';
                }
                messageItem.innerHTML = `<span class="font-bold ${senderClass}">${message.userName}:</span> ${message.text}`;
                container.appendChild(messageItem);
            });
            container.scrollTop = container.scrollHeight;
        }

        /**
         * Renders the list of connected users.
         */
        function renderUsersList() {
            usersList.innerHTML = '';
            connectedUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'p-2 rounded-md hover:bg-gray-700 transition duration-150';
                userItem.innerHTML = `<span class="text-sm font-medium text-gray-300">${user.name}</span>`;
                usersList.appendChild(userItem);
            });
        }

        /**
         * Renders the moderator's connected and banned user lists.
         */
        function renderModUserLists() {
            if (!currentUser || !currentUser.isAdmin) return;
            modConnectedUsersList.innerHTML = '';
            connectedUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'flex items-center justify-between p-2 rounded-md hover:bg-gray-700 transition duration-150';
                userItem.innerHTML = `
                    <span class="text-sm font-medium text-gray-300">${user.name}</span>
                    <button class="ban-button px-2 py-1 text-xs font-bold rounded-lg bg-red-600 hover:bg-red-700 transition duration-200" data-user-id="${user.id}">Ban</button>
                `;
                modConnectedUsersList.appendChild(userItem);
            });

            modBannedUsersList.innerHTML = '';
            bannedUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'flex items-center justify-between p-2 rounded-md hover:bg-gray-700 transition duration-150';
                userItem.innerHTML = `
                    <span class="text-sm font-medium text-gray-400">${user.name}</span>
                    <button class="unban-button px-2 py-1 text-xs font-bold rounded-lg bg-green-600 hover:bg-green-700 transition duration-200" data-user-id="${user.id}">Unban</button>
                `;
                modBannedUsersList.appendChild(userItem);
            });
        }

        /**
         * Renders the list of feature requests.
         */
        function renderFeatureRequests() {
            if (!currentUser || !currentUser.isAdmin) return;

            modFeatureRequestsList.innerHTML = '';
            featureRequests.forEach(request => {
                const requestItem = document.createElement('div');
                requestItem.className = 'flex items-start justify-between p-3 rounded-lg request-item';
                requestItem.innerHTML = `
                    <div class="flex-grow">
                        <span class="font-bold text-gray-300">From ${request.userName}:</span>
                        <p class="text-sm text-gray-400 mt-1">${request.text}</p>
                    </div>
                    <button class="delete-request-button ml-4 px-2 py-1 text-xs font-bold rounded-lg bg-red-600 hover:bg-red-700 transition duration-200" data-request-id="${request.id}">Delete</button>
                `;
                modFeatureRequestsList.appendChild(requestItem);
            });
        }
        
        /**
         * Toggles between chat panels.
         * @param {string} panel - The panel to show ('user', 'moderator', 'admin-chat').
         */
        function togglePanel(panel) {
            userChatPanel.classList.add('hidden');
            moderatorPanel.classList.add('hidden');
            adminChatPanel.classList.add('hidden');
            document.getElementById('mod-control-panel').classList.remove('hidden');
            document.getElementById('mod-feature-requests-panel').classList.remove('hidden');

            switch (panel) {
                case 'user':
                    userChatPanel.classList.remove('hidden');
                    break;
                case 'moderator':
                    moderatorPanel.classList.remove('hidden');
                    break;
                case 'admin-chat':
                    moderatorPanel.classList.remove('hidden');
                    adminChatPanel.classList.remove('hidden');
                    document.getElementById('mod-control-panel').classList.add('hidden');
                    document.getElementById('mod-feature-requests-panel').classList.add('hidden');
                    break;
            }
            currentPanel = panel;
        }

        /**
         * Resets the application state to its initial login screen.
         */
        function resetAppState() {
            ws = null;
            currentUser = null;
            connectedUsers = [];
            bannedUsers = [];
            messages = [];
            adminMessages = [];
            featureRequests = [];
            currentPanel = 'user';
            
            // Clear UI elements
            chatContainer.innerHTML = '';
            messageInput.value = '';
            usersList.innerHTML = '';
            modConnectedUsersList.innerHTML = '';
            modBannedUsersList.innerHTML = '';
            if (modFeatureRequestsList) modFeatureRequestsList.innerHTML = '';
            if (adminChatContainer) adminChatContainer.innerHTML = '';

            // Hide panels and show login
            userChatPanel.classList.add('hidden');
            moderatorPanel.classList.add('hidden');
            adminPanelToggleBtn.classList.add('hidden');
            featureRequestButton.classList.remove('hidden');
            nameModal.classList.remove('hidden');
        }
        
        /**
         * Establishes a WebSocket connection.
         */
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            // Use window.location.host which includes the hostname and port, but is more reliable
            // as Render's internal routing handles the port forwarding for wss.
            const host = window.location.host;
            const wsUrl = `${protocol}//${host}`;

            try {
                ws = new WebSocket(wsUrl);
            } catch (error) {
                console.error("Failed to connect to WebSocket:", error);
                showMessageBox("Failed to connect to the server. Please check your connection or try again later.");
                return;
            }

            ws.onopen = () => {
                console.log("WebSocket connection established.");
                // Send a 'join' message to the server once the connection is open
                ws.send(JSON.stringify({
                    type: 'join',
                    userName: usernameInput.value || 'Admin',
                    password: adminPasswordInput.value
                }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                console.log("Received data:", data);

                switch (data.type) {
                    case 'joinSuccess':
                        currentUser = data.user;
                        nameModal.classList.add('hidden');
                        if (currentUser.isAdmin) {
                            togglePanel('moderator');
                            adminPanelToggleBtn.classList.remove('hidden');
                            modLoggedInAs.textContent = `Logged in as: ${currentUser.name}`;
                        } else {
                            togglePanel('user');
                            currentUserSpan.textContent = `Logged in as: ${currentUser.name}`;
                        }
                        break;
                    case 'chatHistory':
                        messages = data.messages;
                        renderMessages(messages, chatContainer);
                        break;
                    case 'adminChatHistory':
                        adminMessages = data.messages;
                        renderMessages(adminMessages, adminChatContainer);
                        break;
                    case 'newMessage':
                        messages.push(data.message);
                        if (currentPanel === 'user') {
                            renderMessages(messages, chatContainer);
                        }
                        break;
                    case 'newAdminMessage':
                        adminMessages.push(data.message);
                        if (currentPanel === 'admin-chat') {
                            renderMessages(adminMessages, adminChatContainer);
                        }
                        break;
                    case 'updateUserLists':
                        connectedUsers = data.connectedUsers;
                        bannedUsers = data.bannedUsers;
                        renderUsersList();
                        renderModUserLists();
                        break;
                    case 'updateFeatureRequests':
                        featureRequests = data.requests;
                        renderFeatureRequests();
                        break;
                    case 'alert':
                        showMessageBox(data.message);
                        break;
                    case 'banned':
                        showMessageBox(data.message || 'You have been banned from this chat.');
                        ws.close(); // Close the connection if banned
                        break;
                    case 'connectionDenied':
                        showMessageBox(data.reason);
                        ws.close();
                        break;
                    default:
                        console.warn('Unknown message type:', data.type);
                        break;
                }
            };

            ws.onclose = () => {
                console.log("WebSocket connection closed.");
                showMessageBox("Connection to the server was lost. Please log in again.");
                resetAppState();
            };

            ws.onerror = (error) => {
                console.error("WebSocket error:", error);
                // The onclose event will fire after this, so we don't need a separate UI for this.
            };
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Login buttons
            joinChatButton.addEventListener('click', () => {
                const username = usernameInput.value.trim();
                if (username) {
                    connectWebSocket();
                } else {
                    showMessageBox("Please enter a username.");
                }
            });

            adminLoginButton.addEventListener('click', () => {
                const password = adminPasswordInput.value.trim();
                if (password) {
                    usernameInput.value = 'Admin';
                    connectWebSocket();
                } else {
                    showMessageBox("Please enter the admin password.");
                }
            });

            // Chat buttons
            sendButton.addEventListener('click', () => {
                const messageText = messageInput.value.trim();
                if (messageText && ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'chatMessage', text: messageText }));
                    messageInput.value = '';
                }
            });

            adminChatSendBtn.addEventListener('click', () => {
                const messageText = adminChatInput.value.trim();
                if (messageText && ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'adminMessage', text: messageText }));
                    adminChatInput.value = '';
                }
            });

            // Form submission for sending messages
            document.getElementById('message-form').addEventListener('submit', (e) => {
                e.preventDefault();
                sendButton.click();
            });

            document.getElementById('admin-chat-form').addEventListener('submit', (e) => {
                e.preventDefault();
                adminChatSendBtn.click();
            });

            // Leave buttons
            leaveButton.addEventListener('click', () => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.close();
                }
            });

            modLeaveButton.addEventListener('click', () => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.close();
                }
            });
            
            // Panel toggles
            adminPanelToggleBtn.addEventListener('click', () => togglePanel('moderator'));
            adminChatToggleBtn.addEventListener('click', () => togglePanel('admin-chat'));
            adminBackToModPanelBtn.addEventListener('click', () => togglePanel('moderator'));
            
            // Feature request buttons
            featureRequestButton.addEventListener('click', () => {
                featureRequestModal.classList.remove('hidden');
            });
            cancelRequestButton.addEventListener('click', () => {
                featureRequestModal.classList.add('hidden');
                featureRequestInput.value = '';
            });
            submitRequestButton.addEventListener('click', () => {
                const requestText = featureRequestInput.value.trim();
                if (requestText) {
                    if (ws && ws.readyState === WebSocket.OPEN && currentUser) {
                        ws.send(JSON.stringify({ type: 'featureRequest', text: requestText }));
                        featureRequestModal.classList.add('hidden');
                        featureRequestInput.value = '';
                        showMessageBox('Your feature request has been submitted!');
                    } else {
                        showMessageBox('Connection lost. Please reconnect and try again.');
                    }
                } else {
                    showMessageBox('Please enter a description for your feature request.');
                }
            });

            // Moderator actions
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('ban-button')) {
                    const userId = e.target.dataset.userId;
                    if (ws && ws.readyState === WebSocket.OPEN && currentUser && currentUser.isAdmin) {
                        ws.send(JSON.stringify({ type: 'banUser', userId }));
                    }
                }
                if (e.target.classList.contains('unban-button')) {
                    const userId = e.target.dataset.userId;
                    if (ws && ws.readyState === WebSocket.OPEN && currentUser && currentUser.isAdmin) {
                        ws.send(JSON.stringify({ type: 'unbanUser', userId }));
                    }
                }
                if (e.target.classList.contains('delete-request-button')) {
                    const requestId = e.target.dataset.requestId;
                    if (ws && ws.readyState === WebSocket.OPEN && currentUser && currentUser.isAdmin) {
                        ws.send(JSON.stringify({ type: 'deleteFeatureRequest', requestId }));
                    }
                }
            });

            // Message box close button
            closeMessageBox.addEventListener('click', () => {
                customMessageBox.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
